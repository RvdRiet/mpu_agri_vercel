<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#2d5a27">
  <title>Register â€” Mpumalanga AgriSupport</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="nav.css">
  <link rel="stylesheet" href="auth.css">
</head>
<body>
  <div class="page-wrapper">

    <!-- ===== NAVIGATION ===== -->
    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <div class="site-nav__inner">
        <a href="index.html" class="site-nav__brand">
          <span class="site-nav__logo" aria-hidden="true">MP</span>
          <span class="site-nav__brand-text">
            <span class="site-nav__brand-name">Mpumalanga AgriSupport</span>
            <span class="site-nav__brand-sub">Decision Support System</span>
          </span>
        </a>
        <div class="site-nav__links">
          <div class="nav-item"><a href="index.html" class="nav-link">Home</a></div>
          <div class="nav-item">
            <button class="nav-link" type="button" aria-expanded="false">Programmes <span class="nav-link__arrow" aria-hidden="true">&#9660;</span></button>
            <div class="nav-dropdown" role="menu">
              <a href="crop.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#127806;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Crop Management</span><span class="nav-dropdown__desc">Crop farming support &amp; grants</span></span></a>
              <a href="livestock.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#128004;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Livestock Management</span><span class="nav-dropdown__desc">Livestock development &amp; grants</span></span></a>
              <a href="environmental.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#127795;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Environmental Enrichment</span><span class="nav-dropdown__desc">Conservation &amp; sustainability</span></span></a>
            </div>
          </div>
          <div class="nav-item"><a href="weather.html" class="nav-link">Weather</a></div>
          <div class="nav-item"><a href="alerts.html" class="nav-link">Alerts</a></div>
          <div class="nav-item"><a href="guides.html" class="nav-link">Guides</a></div>
          <div class="nav-item"><a href="support.html" class="nav-link">Support</a></div>
          <div class="nav-item">
            <button class="nav-link" type="button" aria-expanded="false">Apply <span class="nav-link__arrow" aria-hidden="true">&#9660;</span></button>
            <div class="nav-dropdown" role="menu">
              <a href="Application/crop.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#128196;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Crop Grant</span><span class="nav-dropdown__desc">Apply for crop development support</span></span></a>
              <a href="Application/index.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#128196;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Livestock Grant</span><span class="nav-dropdown__desc">Masibuyele Esibayeni Programme</span></span></a>
              <a href="Application/environmental.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#128196;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Environmental Grant</span><span class="nav-dropdown__desc">Conservation &amp; enrichment funding</span></span></a>
              <div class="nav-dropdown__divider"></div>
              <a href="track.html" class="nav-dropdown__link" role="menuitem"><span class="nav-dropdown__icon">&#128269;</span><span class="nav-dropdown__text"><span class="nav-dropdown__label">Track Application</span><span class="nav-dropdown__desc">Check your application status</span></span></a>
            </div>
          </div>
        </div>
        <div class="site-nav__actions">
          <a href="login.html" class="nav-link">Login</a>
          <a href="register.html" class="nav-cta">Register</a>
        </div>
        <button class="nav-toggle" id="navToggle" type="button" aria-label="Toggle menu" aria-expanded="false"><span class="nav-toggle__bar"></span></button>
      </div>
      <div class="site-nav__mobile" id="mobileNav">
        <div class="mobile-nav__section"><div class="mobile-nav__heading">Navigation</div><a href="index.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#127968;</span> Home</a><a href="weather.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#9925;</span> Weather</a><a href="alerts.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#9888;</span> Alerts</a><a href="guides.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128214;</span> Guides</a><a href="support.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128222;</span> Support</a></div>
        <div class="mobile-nav__section"><div class="mobile-nav__heading">Programmes</div><a href="crop.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#127806;</span> Crop Management</a><a href="livestock.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128004;</span> Livestock Management</a><a href="environmental.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#127795;</span> Environmental Enrichment</a></div>
        <div class="mobile-nav__section"><div class="mobile-nav__heading">Applications</div><a href="Application/crop.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128196;</span> Crop Grant Application</a><a href="Application/index.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128196;</span> Livestock Grant Application</a><a href="Application/environmental.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128196;</span> Environmental Grant Application</a><a href="track.html" class="mobile-nav__link"><span class="mobile-nav__icon">&#128269;</span> Track Application</a></div>
        <div class="mobile-nav__actions"><a href="login.html" class="btn btn--secondary btn--block">Login</a><a href="register.html" class="btn btn--primary btn--block">Register</a></div>
      </div>
      <div class="mobile-nav-overlay" id="mobileOverlay"></div>
    </nav>

    <!-- ===== PAGE HEADER ===== -->
    <div class="page-header">
      <div class="container">
        <h1 class="page-header__title">Register</h1>
        <p class="page-header__subtitle">Create an account to apply for agricultural support programmes.</p>
      </div>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="auth-page">
      <div class="auth-card">
        <h2 class="auth-heading">Register</h2>
        <p class="auth-intro">Create an account using your South African ID number.</p>

        <form id="registerForm" class="auth-form" novalidate>
          <div class="form-group">
            <label for="regId">South African ID number <span class="required">*</span></label>
            <input type="text" id="regId" name="id" maxlength="13" pattern="\d{13}" placeholder="13 digits, no spaces" autocomplete="off" required />
            <span class="field-error" id="regIdError" aria-live="polite"></span>
          </div>
          <div class="form-group">
            <label for="regName">Full name <span class="required">*</span></label>
            <input type="text" id="regName" name="fullName" placeholder="As on ID document" required />
            <span class="field-error" id="regNameError" aria-live="polite"></span>
          </div>
          <div class="form-group">
            <label for="regPassword">Password <span class="required">*</span></label>
            <input type="password" id="regPassword" name="password" minlength="6" placeholder="At least 6 characters" required />
            <span class="field-error" id="regPasswordError" aria-live="polite"></span>
          </div>
          <div class="form-group">
            <label for="regConfirm">Confirm password <span class="required">*</span></label>
            <input type="password" id="regConfirm" name="confirmPassword" required />
            <span class="field-error" id="regConfirmError" aria-live="polite"></span>
          </div>
          <div class="form-error" id="registerFormError" role="alert"></div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Register</button>
          </div>
        </form>

        <p class="auth-switch">Already have an account? <a href="login.html">Login</a></p>
      </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="site-footer">
      <div class="footer__top"><div class="container"><div class="footer__grid">
        <div><p class="footer__brand-name">Mpumalanga AgriSupport</p><p class="footer__brand-text">Agricultural Decision Support System for the Mpumalanga Department of Agriculture.</p></div>
        <div><h4 class="footer__heading">Programmes</h4><div class="footer__links"><a href="crop.html">Crop Management</a><a href="livestock.html">Livestock Management</a><a href="environmental.html">Environmental Enrichment</a></div></div>
        <div><h4 class="footer__heading">Resources</h4><div class="footer__links"><a href="weather.html">Weather Data</a><a href="alerts.html">Farming Alerts</a><a href="guides.html">Advisory Guides</a><a href="support.html">Support Contacts</a><a href="track.html">Track Application</a></div></div>
        <div><h4 class="footer__heading">Legal</h4><div class="footer__links"><a href="popia.html">POPIA Compliance</a><a href="terms.html">Terms of Service</a><a href="staff-login.html">Staff Portal</a></div></div>
      </div></div></div>
      <div class="footer__bottom"><div class="container"><div class="footer__bottom-inner"><span>&copy; 2025 Mpumalanga Department of Agriculture. All rights reserved.</span><div class="footer__bottom-links"><a href="popia.html">Privacy</a><a href="terms.html">Terms</a></div></div></div></div>
    </footer>

  </div>

  <script src="js/auth.js"></script>
  <script src="js/nav.js"></script>
  <script>
    (function () {
      if (window.FarmAuth && FarmAuth.getCurrentUser()) {
        window.location.href = 'index.html';
        return;
      }
      var form = document.getElementById('registerForm');
      var idInput = document.getElementById('regId');
      var idError = document.getElementById('regIdError');
      var formError = document.getElementById('registerFormError');

      function onlyDigits(e) {
        if (e.key && /[^\d]/.test(e.key) && !e.ctrlKey && !e.metaKey && ['Backspace', 'Tab', 'ArrowLeft', 'ArrowRight'].indexOf(e.key) === -1) e.preventDefault();
      }
      idInput.addEventListener('keypress', onlyDigits);

      function handleResult(result) {
        if (result.ok) {
          window.location.href = 'index.html';
        } else {
          formError.textContent = result.error || 'Registration failed.';
          idInput.classList.add('input-error');
          nameEl.classList.add('input-error');
          passwordEl.classList.add('input-error');
          confirmEl.classList.add('input-error');
        }
      }

      var nameEl = document.getElementById('regName');
      var passwordEl = document.getElementById('regPassword');
      var confirmEl = document.getElementById('regConfirm');
      var nameError = document.getElementById('regNameError');
      var passwordError = document.getElementById('regPasswordError');
      var confirmError = document.getElementById('regConfirmError');

      function clearFieldErrors() {
        idError.textContent = '';
        nameError.textContent = '';
        passwordError.textContent = '';
        confirmError.textContent = '';
        formError.textContent = '';
        [idInput, nameEl, passwordEl, confirmEl].forEach(function (el) { if (el) el.classList.remove('input-error'); });
      }
      idInput.addEventListener('input', clearFieldErrors);
      nameEl.addEventListener('input', clearFieldErrors);
      passwordEl.addEventListener('input', clearFieldErrors);
      confirmEl.addEventListener('input', clearFieldErrors);

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        clearFieldErrors();
        var id = idInput.value.replace(/\s/g, '');
        var name = nameEl.value.trim();
        var password = passwordEl.value;
        var confirm = confirmEl.value;
        var hasError = false;

        if (!id) {
          idError.textContent = 'ID number is required.';
          idInput.classList.add('input-error');
          hasError = true;
        } else if (!window.FarmAuth.isValidSAId(id)) {
          idError.textContent = 'Please enter a valid 13-digit South African ID number.';
          idInput.classList.add('input-error');
          hasError = true;
        }
        if (!name) {
          nameError.textContent = 'Full name is required.';
          nameEl.classList.add('input-error');
          hasError = true;
        }
        if (password.length < 6) {
          passwordError.textContent = 'Password must be at least 6 characters.';
          passwordEl.classList.add('input-error');
          hasError = true;
        }
        if (password !== confirm) {
          confirmError.textContent = 'Passwords do not match.';
          confirmEl.classList.add('input-error');
          hasError = true;
        }
        if (hasError) return;

        var p = FarmAuth.register(id, password, name);
        if (p && typeof p.then === 'function') p.then(handleResult); else handleResult(p);
      });
    })();
  </script>
</body>
</html>
