<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#2d5a27">
  <title>Admin Login</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="auth.css">
</head>
<body>
  <div class="page-wrapper">
    <header class="site-header">
      <div class="header-inner">
        <a href="index.html" class="header-back" aria-label="Back to home"><span aria-hidden="true">←</span> Back</a>
        <a href="index.html" class="site-title-link">
          <h1 class="site-title">Mpumalanga Livestock Development Programme</h1>
        </a>
      </div>
    </header>

    <div class="header-image-wrap">
      <img src="/images/mainheader.jpg" alt="" class="header-image" width="100%" />
    </div>

    <main class="main-content auth-page">
      <div class="auth-card staff-login-card">
        <h2 class="auth-heading">Admin Login</h2>
        <p class="auth-intro">Authorised personnel only. Log in to review and manage applications.</p>

        <form id="staffLoginForm" class="auth-form" novalidate>
          <div class="form-group">
            <label for="staffUsername">Username</label>
            <input type="text" id="staffUsername" name="username" autocomplete="username" required />
            <span class="field-error" id="staffUsernameError" aria-live="polite"></span>
          </div>
          <div class="form-group">
            <label for="staffPassword">Password</label>
            <input type="password" id="staffPassword" name="password" required />
            <span class="field-error" id="staffPasswordError" aria-live="polite"></span>
          </div>
          <div class="form-error" id="staffFormError" role="alert"></div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Login</button>
          </div>
        </form>

        <p class="auth-switch"><a href="index.html">← Back to programme</a></p>
      </div>
    </main>

    <footer class="site-footer">
      <div class="footer-image-wrap">
        <img src="public/footer.jpg" alt="" class="footer-image" />
      </div>
      <div class="footer-inner">
        <p class="footer-copyright">&copy; Mpumalanga Livestock Development Programme</p>
        <div class="footer-links">
          <a href="popia.html" class="footer-btn">POPIA compliance</a>
          <a href="terms.html" class="footer-btn">Terms of service</a>
          <a href="staff-login.html" class="footer-btn">Admin login</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="js/staff-auth.js"></script>
  <script>
    (function () {
      if (window.FarmStaffAuth && FarmStaffAuth.getCurrentStaff()) {
        window.location.href = 'staff.html';
        return;
      }
      var form = document.getElementById('staffLoginForm');
      var usernameEl = document.getElementById('staffUsername');
      var passwordEl = document.getElementById('staffPassword');
      var usernameError = document.getElementById('staffUsernameError');
      var passwordError = document.getElementById('staffPasswordError');
      var formError = document.getElementById('staffFormError');

      function clearFieldErrors() {
        usernameError.textContent = '';
        passwordError.textContent = '';
        formError.textContent = '';
        usernameEl.classList.remove('input-error');
        passwordEl.classList.remove('input-error');
      }

      usernameEl.addEventListener('input', clearFieldErrors);
      usernameEl.addEventListener('blur', clearFieldErrors);
      passwordEl.addEventListener('input', clearFieldErrors);
      passwordEl.addEventListener('blur', clearFieldErrors);

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        clearFieldErrors();
        var username = usernameEl.value.trim();
        var password = passwordEl.value;

        var hasError = false;
        if (!username) {
          usernameError.textContent = 'Username or email is required.';
          usernameEl.classList.add('input-error');
          hasError = true;
        }
        if (!password) {
          passwordError.textContent = 'Password is required.';
          passwordEl.classList.add('input-error');
          hasError = true;
        }
        if (hasError) return;

        var result = FarmStaffAuth.login(username, password);
        if (result && result.ok) {
          window.location.href = 'staff.html';
        } else {
          formError.textContent = (result && result.error) || 'Login failed.';
          usernameEl.classList.add('input-error');
          passwordEl.classList.add('input-error');
        }
      });
    })();
  </script>
</body>
</html>
